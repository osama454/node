<!DOCTYPE html>
<html>
  <head>
    <title>Lightboard</title>
    <style>
      /* Styling the body */
      body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      /* The container for the lightboard, displayed as a grid */
      #lightboard {
        display: grid;
        border-collapse: collapse;
      }

      /* Each light element */
      .light {
        width: 30px;
        height: 30px;
        border: 1px solid #ccc;
        text-align: center;
        cursor: pointer;
      }

      /* Light that is on */
      .on {
        background-color: #90caf9; /* Light Blue */
      }

      /* Light that is off */
      .off {
        background-color: #e3f2fd; /* Lighter Blue */
      }

      /* Light that has burnt out */
      .burnt {
        background-color: #b0bec5; /* Grey */
      }
    </style>
  </head>
  <body>
    <!-- Heading for the lightboard -->
    <h1>Lightboard</h1>

    <!-- Inputs to specify the number of rows and columns for the lightboard -->
    <div>
      Rows: <input type="number" id="rows" value="5" /> Columns:
      <input type="number" id="cols" value="5" />
      <button onclick="createLightboard()">Create</button>
    </div>

    <!-- Div to hold the lightboard -->
    <div id="lightboard"></div>

    <script>
      let lightboard; // 2D array to represent the lightboard
      let turns = 0; // Counter for the number of turns

      /**
       * Function to initialize the lightboard with user-specified rows and columns.
       * Each light has a 10% chance to start "on" and a 90% chance to start "off".
       */
      function createLightboard() {
        const rows = parseInt(document.getElementById("rows").value); // Get number of rows
        const cols = parseInt(document.getElementById("cols").value); // Get number of columns
        turns = 0; // Reset the turn count when creating a new board

        // Initialize the lightboard as a 2D array
        lightboard = Array(rows)
          .fill(0)
          .map(() => Array(cols).fill(0));

        // Set up each light with an initial state and properties
        for (let i = 0; i < rows; i++) {
          for (let j = 0; j < cols; j++) {
            if (Math.random() < 0.1) {
              // 10% chance the light is "on" at the start
              lightboard[i][j] = { state: 1, turnsOn: 0, burnt: false };
            } else {
              // Otherwise, the light starts "off"
              lightboard[i][j] = { state: 0, turnsOn: 0, burnt: false };
            }
          }
        }

        // Render the lightboard after it has been created
        renderLightboard();
      }

      /**
       * Function to display the current state of the lightboard on the screen.
       * It updates the DOM with the appropriate visual representation of each light.
       */
      function renderLightboard() {
        const boardDiv = document.getElementById("lightboard");
        boardDiv.innerHTML = ""; // Clear previous lightboard contents
        boardDiv.style.gridTemplateColumns = `repeat(${lightboard[0].length}, 1fr)`; // Set grid layout

        // Create and append a div for each light
        for (let i = 0; i < lightboard.length; i++) {
          for (let j = 0; j < lightboard[i].length; j++) {
            const lightDiv = document.createElement("div");
            lightDiv.classList.add("light");
            lightDiv.dataset.row = i;
            lightDiv.dataset.col = j;
            lightDiv.addEventListener("click", toggleLight); // Add click event listener to toggle light state

            // Update the class based on the light's current state
            if (lightboard[i][j].burnt) {
              lightDiv.classList.add("burnt"); // If burnt out, use burnt styling
            } else if (lightboard[i][j].state === 1) {
              lightDiv.classList.add("on"); // If the light is on, apply "on" class
            } else {
              lightDiv.classList.add("off"); // If the light is off, apply "off" class
            }

            // Append the light div to the board container
            boardDiv.appendChild(lightDiv);
          }
        }
      }

      /**
       * Function to handle toggling a light when it is clicked.
       * Also toggles the surrounding lights and checks for burnouts.
       */
      function toggleLight(event) {
        const row = parseInt(event.target.dataset.row); // Get row of the clicked light
        const col = parseInt(event.target.dataset.col); // Get column of the clicked light

        // If the clicked light is not burnt out
        if (!lightboard[row][col].burnt) {
          turns++; // Increment the turn count
          lightboard[row][col].state = 1 - lightboard[row][col].state; // Toggle the clicked light's state

          // If the light is turned on, increment its turnsOn count
          if (lightboard[row][col].state === 1) {
            lightboard[row][col].turnsOn++;
          } else {
            lightboard[row][col].turnsOn = 0; // Reset turnsOn if turned off
          }

          // Check if the light should burn out
          if (Math.random() < 0.2 || lightboard[row][col].turnsOn > 5) {
            lightboard[row][col].burnt = true; // Burn out the light
            lightboard[row][col].state = 0; // Ensure burnt light is off
          }

          // Toggle surrounding lights, affecting only non-burnt lights
          for (
            let i = Math.max(0, row - 1);
            i <= Math.min(lightboard.length - 1, row + 1);
            i++
          ) {
            for (
              let j = Math.max(0, col - 1);
              j <= Math.min(lightboard[0].length - 1, col + 1);
              j++
            ) {
              if (!(i === row && j === col) && !lightboard[i][j].burnt) {
                lightboard[i][j].state = 1 - lightboard[i][j].state; // Toggle surrounding light states

                // If the surrounding light is turned on, increment its turnsOn count
                if (lightboard[i][j].state === 1) {
                  lightboard[i][j].turnsOn++;
                } else {
                  lightboard[i][j].turnsOn = 0; // Reset turnsOn if turned off
                }

                // Check if the surrounding light should burn out
                if (Math.random() < 0.2 || lightboard[i][j].turnsOn > 5) {
                  lightboard[i][j].burnt = true; // Burn out the light
                  lightboard[i][j].state = 0; // Ensure burnt light is off
                }
              }
            }
          }

          // Re-render the lightboard after all updates
          renderLightboard();
        }
      }
    </script>
  </body>
</html>
